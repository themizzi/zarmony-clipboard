Ported from the excellent oh-my-zsh.